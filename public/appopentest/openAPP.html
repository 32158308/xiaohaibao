<center style="padding-top:20vh;"><a id="call-app" href="javascript:;" style="font-size:80px;" > Start or Download </a></center>

<script>
    (function(){
        var config = {
            /*scheme:必须*/
            scheme: 'openapp.jdmobile://virtual?',
            download_url: 'https://www.baidu.com/',
            timeout: 600
        };

        function openclient() {
            // 判断浏览器
            var Navigator = navigator.userAgent;
            var ifChrome = Navigator.match(/Chrome/i) != null && Navigator.match(/Version\/\d+\.\d+(\.\d+)?\sChrome\//i) == null ? true : false;  
            var ifAndroid = (Navigator.match(/(Android);?[\s\/]+([\d.]+)?/)) ? true : false;
            var ifiPad = (Navigator.match(/(iPad).*OS\s([\d_]+)/)) ? true : false;
            var ifiPhone = (!ifiPad && Navigator.match(/(iPhone\sOS)\s([\d_]+)/)) ? true : false;
            var ifSafari = (ifiPhone || ifiPad) && Navigator.match(/Safari/);
            var version = 0;
            ifSafari && (version = Navigator.match(/Version\/([\d\.]+)/));
            version = parseFloat(version[1], 10);
            // 是否从微信打开
            var ifWeixin = navigator.userAgent.indexOf("MicroMessenger") >= 0; // weixin

            var startTime = Date.now();
            
            if(ifSafari && version >= 9){
                setTimeout(function() {  // 必须要使用settimeout
                    var a = document.createElement("a"); //创建a元素
                    a.setAttribute("href", config.scheme), a.style.display = "block", document.body.appendChild(a);
                    var T = document.createEvent("HTMLEvents"); // 返回新创建的 Event 对象，具有指定的类型。
                    T.initEvent("click", false, false);// 初始化新事件对象的属性,   a.dispatchEvent(T)  // 绑定事件
                    a.dispatchEvent(T);
                    // 如果没跳走，则跳转下载
                    var sto = setTimeout(function(){
                        // window.location = config.download_url;
                        window.location.reload();
                    },2000);
                    window.onblur = function() {
                        clearTimeout(sto);
                    }
                }, 0);
            }else{
                var ifr = document.createElement('iframe');
                ifr.src = config.scheme;
                ifr.style.display = 'none';
                document.body.appendChild(ifr);

                var t = setTimeout(function() {
                    var endTime = Date.now();
                    if (!startTime || endTime - startTime < config.timeout + 200) { 
                        window.location = config.download_url;
                    } else {

                    }
                }, config.timeout);

                window.onblur = function() {
                    clearTimeout(t);
                }
            }            
        }

        window.addEventListener("DOMContentLoaded", function(){
            document.getElementById("call-app").addEventListener('click', 
                openclient, false);
        }, false);

    })()
</script>